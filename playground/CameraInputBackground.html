<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello, World! â€¢ A-Frame</title>
    <meta name="description" content="Hello camera!">
    <style>
        video {
            width: 100% !important;
            max-width: 100% !important;
            height: auto !important;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1000;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/0.5.0/aframe.min.js"></script>
    <script>
        navigator.mediaDevices.getUserMedia({
            audio: false,
            video: { facingMode: { exact: "environment" } }
        })
            .then(function (stream) {
                var videoTracks = stream.getVideoTracks();
                // console.log('Got stream with constraints:', constraints);
                console.log('Using video device: ' + videoTracks[0].label);

                var video = document.getElementById('kentucky-derby');

                video.src = window.URL.createObjectURL(stream);

                stream.onended = function () {
                    console.log('Stream ended');
                };
                // window.stream = stream; // make variable available to console
                // video.srcObject = stream;
            })
            .catch(function (error) {
                // ...
            })

        // navigator.getUserMedia({ video: { id: "08afdfdad3eb0e4ccc7fce4eb9d17a8128cc0e8bf5518e926b774e8fe53fc989" }, audio: false, }, function (localMediaStream) {

        //     var video = document.getElementById('kentucky-derby');

        //     video.src = window.URL.createObjectURL(localMediaStream);

        //     // Note: onloadedmetadata doesn't fire in Chrome when using it with getUserMedia.
        //     // See crbug.com/110938.
        //     video.onloadedmetadata = function (e) {
        //         // Ready to go. Do some stuff.
        //     };

        // }, function (error) {
        //     console.log(JSON.stringify(error))
        // });

        function fakeOnMessage() {
            var el = document.getElementById('cube');
            var currentPosition = el.getAttribute('position');

            el.setAttribute('position', { x: 1, y: 5, z: -3 });
        }

        setInterval(fakeOnMessage, 5000);
    </script>
</head>

<body>
    <a-scene>
        <a-assets>
            <video id="kentucky-derby" autoplay="true"></video>
        </a-assets>
        <a-sky src="#kentucky-derby" opacity="0.7"></a-sky>
        <a-box id="cube" color="red" position="0 2 -5" rotation="0 45 45" scale="2 2 2"></a-box>
        <a-entity position="-8 0 0">
            <a-camera>
            </a-camera>
        </a-entity>
    </a-scene>
</body>

</html>